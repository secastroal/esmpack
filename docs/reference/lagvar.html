<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a Lagged Variable — lagvar • esmpack</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create a Lagged Variable — lagvar" />
<meta property="og:description" content="Function to create a lagged variable." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">esmpack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/esmpack-package.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/wviechtb">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/wviechtb/esmpack">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a Lagged Variable</h1>
    
    <div class="hidden name"><code>lagvar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function to create a lagged variable.</p>
    </div>

    <pre class="usage"><span class='fu'>lagvar</span>(<span class='no'>x</span>, <span class='no'>id</span>, <span class='no'>obs</span>, <span class='no'>day</span>, <span class='no'>time</span>, <span class='no'>data</span>, <span class='kw'>lag</span><span class='kw'>=</span><span class='fl'>1</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>vector to specify the variable to be lagged.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>optional vector to specify a subject id variable.</p></td>
    </tr>
    <tr>
      <th>obs</th>
      <td><p>optional numeric vector that indicates the observation number of the values specified via the <code>x</code> argument.</p></td>
    </tr>
    <tr>
      <th>day</th>
      <td><p>optional vector to specify a day number variable.</p></td>
    </tr>
    <tr>
      <th>time</th>
      <td><p>optional vector to specify a variable that indicates the actual date and time of the observations.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>optional data frame that contains the variables specified above.</p></td>
    </tr>
    <tr>
      <th>lag</th>
      <td><p>scalar specifying the lag (default is <code>1</code>). Can also be a vector with multiple lag values that are permitted. See &#8216;Details&#8217;.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function can be used to create a lagged version of the variable specified via the <code>x</code> argument.</p>
<p>The (optional) <code>id</code> argument is used to specify a subject id variable. If not specified, all observations are assumed to come from the same subject. If the dataset includes multiple subjects, then this variable needs to be specified so that observations are not lagged across subjects.</p>
<p>The (optional) <code>obs</code> argument is used to specify a variable that indicates the observation number of the values specified via the <code>x</code> argument. There should not be repeated values of <code>obs</code> (within the same subject, in case the dataset includes multiple subjects). If not specified, then consecutive observations from the same subjects are assumed to be one lag apart.</p>
<p>The (optional) <code>day</code> variable is used to specify a day number variable. If not specified, then values of the variable to be lagged are allowed to be lagged across days (in case there are multiple observation days). If the <code>day</code> variable is specified, then lagged values across different days are not allowed (i.e., are set to missing).</p>
<p>The (optional) <code>time</code> variable is used to specify a variable that indicates the actual date and time of the observations. Ideally this should be a <code><a href='https://rdrr.io/r/base/DateTimeClasses.html'>POSIXct</a></code> variable, but can also be numeric as long as this variable indicates the passage of time (e.g., in minutes) since some reference point (e.g., the first observation of each subject).</p>
<p>The <code>lag</code> argument is used to specify the number of lags (i.e., the lagged value of the variable at a particular observation number \(t\) is the value of the variable observed at observation number \(t - lag\)). If no lagged value is available at observation number \(t - lag\) (either because the dataset does not include that observation number or the value at that observation number is missing), then the lagged value will be missing.</p>
<p>One can also specify multiple values for the <code>lag</code> argument (usually a consecutive range, such as <code>1:3</code>). In that case, the function will find the lagged value with the smallest lag and also indicate the lag of each lagged value. See &#8216;Examples&#8217;.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>lag</code> is a single number, the function returns a vector with the lagged values (that will typically be added back to the data frame as a new variable).</p>
<p>If a <code>time</code> variable is also specified, then the function returns a data frame with elements <code>xl</code> for the lagged values and <code>timelag</code> for the time lag between the observations (in seconds if the <code>time</code> variable was of class <code>POSIXct</code> and otherwise in the units of the <code>time</code> variable).</p>
<p>If multiple values are specified for <code>lag</code>, the function returns a data frame with elements <code>xl</code> for the lagged values and <code>lag</code> for the lag of those values (and again <code>timelag</code> if a <code>time</code> variable was also specified).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># illustrative dataset (10 beeps for 2 days for 2 subjects)</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>subject</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>,
<span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>,
<span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>), <span class='kw'>dayno</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>,
<span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>,
<span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>1L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>, <span class='fl'>2L</span>), <span class='kw'>beep</span> <span class='kw'>=</span>
<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1L</span>, <span class='fl'>2L</span>, <span class='fl'>3L</span>, <span class='fl'>4L</span>, <span class='fl'>5L</span>, <span class='fl'>6L</span>, <span class='fl'>7L</span>, <span class='fl'>8L</span>, <span class='fl'>9L</span>, <span class='fl'>10L</span>, <span class='fl'>11L</span>, <span class='fl'>12L</span>, <span class='fl'>13L</span>, <span class='fl'>14L</span>, <span class='fl'>15L</span>, <span class='fl'>16L</span>,
<span class='fl'>17L</span>, <span class='fl'>18L</span>, <span class='fl'>19L</span>, <span class='fl'>20L</span>, <span class='fl'>1L</span>, <span class='fl'>2L</span>, <span class='fl'>3L</span>, <span class='fl'>4L</span>, <span class='fl'>5L</span>, <span class='fl'>6L</span>, <span class='fl'>7L</span>, <span class='fl'>8L</span>, <span class='fl'>9L</span>, <span class='fl'>10L</span>, <span class='fl'>11L</span>, <span class='fl'>12L</span>, <span class='fl'>13L</span>,
<span class='fl'>14L</span>, <span class='fl'>15L</span>, <span class='fl'>16L</span>, <span class='fl'>17L</span>, <span class='fl'>18L</span>, <span class='fl'>19L</span>, <span class='fl'>20L</span>), <span class='kw'>beeptime</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1571551380</span>,
<span class='fl'>1571558400</span>, <span class='fl'>1571563080</span>, <span class='fl'>1571567640</span>, <span class='fl'>1571573760</span>, <span class='fl'>1571580900</span>, <span class='fl'>1571582820</span>,
<span class='fl'>1571590860</span>, <span class='fl'>1571595360</span>, <span class='fl'>1571599320</span>, <span class='fl'>1571640120</span>, <span class='fl'>1571643180</span>, <span class='fl'>1571650680</span>,
<span class='fl'>1571656140</span>, <span class='fl'>1571660760</span>, <span class='fl'>1571666100</span>, <span class='fl'>1571671080</span>, <span class='fl'>1571675280</span>, <span class='fl'>1571681880</span>,
<span class='fl'>1571688480</span>, <span class='fl'>1571812380</span>, <span class='fl'>1571815080</span>, <span class='fl'>1571823360</span>, <span class='fl'>1571828220</span>, <span class='fl'>1571832780</span>,
<span class='fl'>1571838900</span>, <span class='fl'>1571842320</span>, <span class='fl'>1571851380</span>, <span class='fl'>1571854380</span>, <span class='fl'>1571859600</span>, <span class='fl'>1571900280</span>,
<span class='fl'>1571903700</span>, <span class='fl'>1571910060</span>, <span class='fl'>1571915340</span>, <span class='fl'>1571922360</span>, <span class='fl'>1571925660</span>, <span class='fl'>1571931360</span>,
<span class='fl'>1571938680</span>, <span class='fl'>1571943960</span>, <span class='fl'>1571948160</span>), <span class='kw'>class</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"POSIXct"</span>, <span class='st'>"POSIXt"</span>)),
<span class='kw'>relaxed</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>NA</span>, <span class='fl'>5</span>, <span class='fl'>1</span>, <span class='fl'>NA</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>NA</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>4</span>,
<span class='fl'>2</span>, <span class='fl'>7</span>, <span class='fl'>7</span>, <span class='fl'>NA</span>, <span class='fl'>NA</span>, <span class='fl'>7</span>, <span class='fl'>7</span>, <span class='fl'>1</span>, <span class='fl'>7</span>, <span class='fl'>6</span>, <span class='fl'>NA</span>, <span class='fl'>7</span>, <span class='fl'>6</span>, <span class='fl'>NA</span>, <span class='fl'>NA</span>, <span class='fl'>NA</span>, <span class='fl'>7</span>, <span class='fl'>4</span>, <span class='fl'>7</span>, <span class='fl'>7</span>)),
<span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>NA</span>, <span class='fl'>40L</span>), <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"data.frame"</span>)

<span class='co'># lag the relaxed variable</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>beep</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA
#&gt; 2        1     1    2 2019-10-20 10:00:00       6           2
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           6
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           5
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           6
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6
#&gt; 10       1     1   10 2019-10-20 21:22:00       5          NA
#&gt; 11       1     2   11 2019-10-21 08:42:00       1           5
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA           1
#&gt; 13       1     2   13 2019-10-21 11:38:00       6          NA
#&gt; 14       1     2   14 2019-10-21 13:09:00       6           6
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6
#&gt; 17       1     2   17 2019-10-21 17:18:00       6          NA
#&gt; 18       1     2   18 2019-10-21 18:28:00       6           6
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA
#&gt; 22       2     1    2 2019-10-23 09:18:00       7           2
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           7
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA          NA
#&gt; 26       2     1    6 2019-10-23 15:55:00       7          NA
#&gt; 27       2     1    7 2019-10-23 16:52:00       7           7
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           1
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           7
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA           6
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA
#&gt; 33       2     2   13 2019-10-24 11:41:00       6           7
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           6
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA          NA
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA          NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7          NA
#&gt; 38       2     2   18 2019-10-24 19:38:00       4           7
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           4
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           7</div><div class='input'>
<span class='co'># in this example, consecutive observations from the same subject are each</span>
<span class='co'># one lag apart, so one can leave out the 'obs' (i.e., 'beep') argument here</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA
#&gt; 2        1     1    2 2019-10-20 10:00:00       6           2
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           6
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           5
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           6
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6
#&gt; 10       1     1   10 2019-10-20 21:22:00       5          NA
#&gt; 11       1     2   11 2019-10-21 08:42:00       1           5
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA           1
#&gt; 13       1     2   13 2019-10-21 11:38:00       6          NA
#&gt; 14       1     2   14 2019-10-21 13:09:00       6           6
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6
#&gt; 17       1     2   17 2019-10-21 17:18:00       6          NA
#&gt; 18       1     2   18 2019-10-21 18:28:00       6           6
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA
#&gt; 22       2     1    2 2019-10-23 09:18:00       7           2
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           7
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA          NA
#&gt; 26       2     1    6 2019-10-23 15:55:00       7          NA
#&gt; 27       2     1    7 2019-10-23 16:52:00       7           7
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           1
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           7
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA           6
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA
#&gt; 33       2     2   13 2019-10-24 11:41:00       6           7
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           6
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA          NA
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA          NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7          NA
#&gt; 38       2     2   18 2019-10-24 19:38:00       4           7
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           4
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           7</div><div class='input'>
<span class='co'># but this also allows lagged values across days (e.g., the value '5' from</span>
<span class='co'># beep 10 on day 1 becomes the lagged value for beep 11 on day 2); this can</span>
<span class='co'># be avoided by specifying the day variable</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>beep</span>, <span class='kw'>day</span><span class='kw'>=</span><span class='no'>dayno</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA
#&gt; 2        1     1    2 2019-10-20 10:00:00       6           2
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           6
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           5
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           6
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6
#&gt; 10       1     1   10 2019-10-20 21:22:00       5          NA
#&gt; 11       1     2   11 2019-10-21 08:42:00       1          NA
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA           1
#&gt; 13       1     2   13 2019-10-21 11:38:00       6          NA
#&gt; 14       1     2   14 2019-10-21 13:09:00       6           6
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6
#&gt; 17       1     2   17 2019-10-21 17:18:00       6          NA
#&gt; 18       1     2   18 2019-10-21 18:28:00       6           6
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA
#&gt; 22       2     1    2 2019-10-23 09:18:00       7           2
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           7
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA          NA
#&gt; 26       2     1    6 2019-10-23 15:55:00       7          NA
#&gt; 27       2     1    7 2019-10-23 16:52:00       7           7
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           1
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           7
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA          NA
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA
#&gt; 33       2     2   13 2019-10-24 11:41:00       6           7
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           6
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA          NA
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA          NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7          NA
#&gt; 38       2     2   18 2019-10-24 19:38:00       4           7
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           4
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           7</div><div class='input'>
<span class='co'># lag the variable by two observations</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>beep</span>, <span class='kw'>day</span><span class='kw'>=</span><span class='no'>dayno</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>lag</span><span class='kw'>=</span><span class='fl'>2</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA
#&gt; 2        1     1    2 2019-10-20 10:00:00       6          NA
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           2
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           6
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           5
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6
#&gt; 10       1     1   10 2019-10-20 21:22:00       5           6
#&gt; 11       1     2   11 2019-10-21 08:42:00       1          NA
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA          NA
#&gt; 13       1     2   13 2019-10-21 11:38:00       6           1
#&gt; 14       1     2   14 2019-10-21 13:09:00       6          NA
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6
#&gt; 17       1     2   17 2019-10-21 17:18:00       6           6
#&gt; 18       1     2   18 2019-10-21 18:28:00       6          NA
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA
#&gt; 22       2     1    2 2019-10-23 09:18:00       7          NA
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           2
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA           7
#&gt; 26       2     1    6 2019-10-23 15:55:00       7          NA
#&gt; 27       2     1    7 2019-10-23 16:52:00       7          NA
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           7
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           1
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA          NA
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA
#&gt; 33       2     2   13 2019-10-24 11:41:00       6          NA
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           7
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA           6
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA          NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7          NA
#&gt; 38       2     2   18 2019-10-24 19:38:00       4          NA
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           7
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           4</div><div class='input'>
<span class='co'># lag the variable by up to 5 observations (taking whatever lag is smallest)</span>
<span class='co'># note: this creates two variables (xl and lag), which we can add back to the dataset</span>
<span class='no'>tmp</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>beep</span>, <span class='kw'>day</span><span class='kw'>=</span><span class='no'>dayno</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>, <span class='kw'>lag</span><span class='kw'>=</span><span class='fl'>1</span>:<span class='fl'>5</span>)
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='no'>tmp</span>$<span class='no'>xl</span>
<span class='no'>dat</span>$<span class='no'>lag</span> <span class='kw'>&lt;-</span> <span class='no'>tmp</span>$<span class='no'>lag</span>
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag lag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA  NA
#&gt; 2        1     1    2 2019-10-20 10:00:00       6           2   1
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           6   1
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6   1
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6   1
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           5   1
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           6   1
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6   1
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6   1
#&gt; 10       1     1   10 2019-10-20 21:22:00       5           6   2
#&gt; 11       1     2   11 2019-10-21 08:42:00       1          NA  NA
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA           1   1
#&gt; 13       1     2   13 2019-10-21 11:38:00       6           1   2
#&gt; 14       1     2   14 2019-10-21 13:09:00       6           6   1
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6   1
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6   1
#&gt; 17       1     2   17 2019-10-21 17:18:00       6           6   2
#&gt; 18       1     2   18 2019-10-21 18:28:00       6           6   1
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6   1
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6   1
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA  NA
#&gt; 22       2     1    2 2019-10-23 09:18:00       7           2   1
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           7   1
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7   1
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA           7   2
#&gt; 26       2     1    6 2019-10-23 15:55:00       7           7   3
#&gt; 27       2     1    7 2019-10-23 16:52:00       7           7   1
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7   1
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           1   1
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           7   1
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA          NA  NA
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA  NA
#&gt; 33       2     2   13 2019-10-24 11:41:00       6           7   1
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           6   1
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA           6   2
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA           6   3
#&gt; 37       2     2   17 2019-10-24 17:36:00       7           6   4
#&gt; 38       2     2   18 2019-10-24 19:38:00       4           7   1
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           4   1
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           7   1</div><div class='input'>
<span class='co'># remove those new variables</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>dat</span>$<span class='no'>lag</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed
#&gt; 1        1     1    1 2019-10-20 08:03:00       2
#&gt; 2        1     1    2 2019-10-20 10:00:00       6
#&gt; 3        1     1    3 2019-10-20 11:18:00       6
#&gt; 4        1     1    4 2019-10-20 12:34:00       6
#&gt; 5        1     1    5 2019-10-20 14:16:00       5
#&gt; 6        1     1    6 2019-10-20 16:15:00       6
#&gt; 7        1     1    7 2019-10-20 16:47:00       6
#&gt; 8        1     1    8 2019-10-20 19:01:00       6
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA
#&gt; 10       1     1   10 2019-10-20 21:22:00       5
#&gt; 11       1     2   11 2019-10-21 08:42:00       1
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA
#&gt; 13       1     2   13 2019-10-21 11:38:00       6
#&gt; 14       1     2   14 2019-10-21 13:09:00       6
#&gt; 15       1     2   15 2019-10-21 14:26:00       6
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA
#&gt; 17       1     2   17 2019-10-21 17:18:00       6
#&gt; 18       1     2   18 2019-10-21 18:28:00       6
#&gt; 19       1     2   19 2019-10-21 20:18:00       6
#&gt; 20       1     2   20 2019-10-21 22:08:00       4
#&gt; 21       2     1    1 2019-10-23 08:33:00       2
#&gt; 22       2     1    2 2019-10-23 09:18:00       7
#&gt; 23       2     1    3 2019-10-23 11:36:00       7
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA
#&gt; 26       2     1    6 2019-10-23 15:55:00       7
#&gt; 27       2     1    7 2019-10-23 16:52:00       7
#&gt; 28       2     1    8 2019-10-23 19:23:00       1
#&gt; 29       2     1    9 2019-10-23 20:13:00       7
#&gt; 30       2     1   10 2019-10-23 21:40:00       6
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA
#&gt; 32       2     2   12 2019-10-24 09:55:00       7
#&gt; 33       2     2   13 2019-10-24 11:41:00       6
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7
#&gt; 38       2     2   18 2019-10-24 19:38:00       4
#&gt; 39       2     2   19 2019-10-24 21:06:00       7
#&gt; 40       2     2   20 2019-10-24 22:16:00       7</div><div class='input'>
<span class='co'># lag the relaxed variable and also get time difference</span>
<span class='no'>tmp</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>beep</span>, <span class='kw'>day</span><span class='kw'>=</span><span class='no'>dayno</span>, <span class='kw'>time</span><span class='kw'>=</span><span class='no'>beeptime</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='no'>tmp</span>$<span class='no'>xl</span>
<span class='no'>dat</span>$<span class='no'>timelag</span> <span class='kw'>&lt;-</span> <span class='no'>tmp</span>$<span class='no'>timelag</span>
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag   timelag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA   NA secs
#&gt; 2        1     1    2 2019-10-20 10:00:00       6           2 7020 secs
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           6 4680 secs
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6 4560 secs
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6 6120 secs
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           5 7140 secs
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           6 1920 secs
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6 8040 secs
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6 4500 secs
#&gt; 10       1     1   10 2019-10-20 21:22:00       5          NA   NA secs
#&gt; 11       1     2   11 2019-10-21 08:42:00       1          NA   NA secs
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA           1 3060 secs
#&gt; 13       1     2   13 2019-10-21 11:38:00       6          NA   NA secs
#&gt; 14       1     2   14 2019-10-21 13:09:00       6           6 5460 secs
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6 4620 secs
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6 5340 secs
#&gt; 17       1     2   17 2019-10-21 17:18:00       6          NA   NA secs
#&gt; 18       1     2   18 2019-10-21 18:28:00       6           6 4200 secs
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6 6600 secs
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6 6600 secs
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA   NA secs
#&gt; 22       2     1    2 2019-10-23 09:18:00       7           2 2700 secs
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           7 8280 secs
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7 4860 secs
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA          NA   NA secs
#&gt; 26       2     1    6 2019-10-23 15:55:00       7          NA   NA secs
#&gt; 27       2     1    7 2019-10-23 16:52:00       7           7 3420 secs
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7 9060 secs
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           1 3000 secs
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           7 5220 secs
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA          NA   NA secs
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA   NA secs
#&gt; 33       2     2   13 2019-10-24 11:41:00       6           7 6360 secs
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           6 5280 secs
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA          NA   NA secs
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA          NA   NA secs
#&gt; 37       2     2   17 2019-10-24 17:36:00       7          NA   NA secs
#&gt; 38       2     2   18 2019-10-24 19:38:00       4           7 7320 secs
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           4 5280 secs
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           7 4200 secs</div><div class='input'>
<span class='co'># timelag in minutes</span>
<span class='no'>dat</span>$<span class='no'>timelag</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>tmp</span>$<span class='no'>timelag</span>, <span class='kw'>units</span><span class='kw'>=</span><span class='st'>"mins"</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed relaxed_lag timelag
#&gt; 1        1     1    1 2019-10-20 08:03:00       2          NA      NA
#&gt; 2        1     1    2 2019-10-20 10:00:00       6           2     117
#&gt; 3        1     1    3 2019-10-20 11:18:00       6           6      78
#&gt; 4        1     1    4 2019-10-20 12:34:00       6           6      76
#&gt; 5        1     1    5 2019-10-20 14:16:00       5           6     102
#&gt; 6        1     1    6 2019-10-20 16:15:00       6           5     119
#&gt; 7        1     1    7 2019-10-20 16:47:00       6           6      32
#&gt; 8        1     1    8 2019-10-20 19:01:00       6           6     134
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA           6      75
#&gt; 10       1     1   10 2019-10-20 21:22:00       5          NA      NA
#&gt; 11       1     2   11 2019-10-21 08:42:00       1          NA      NA
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA           1      51
#&gt; 13       1     2   13 2019-10-21 11:38:00       6          NA      NA
#&gt; 14       1     2   14 2019-10-21 13:09:00       6           6      91
#&gt; 15       1     2   15 2019-10-21 14:26:00       6           6      77
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA           6      89
#&gt; 17       1     2   17 2019-10-21 17:18:00       6          NA      NA
#&gt; 18       1     2   18 2019-10-21 18:28:00       6           6      70
#&gt; 19       1     2   19 2019-10-21 20:18:00       6           6     110
#&gt; 20       1     2   20 2019-10-21 22:08:00       4           6     110
#&gt; 21       2     1    1 2019-10-23 08:33:00       2          NA      NA
#&gt; 22       2     1    2 2019-10-23 09:18:00       7           2      45
#&gt; 23       2     1    3 2019-10-23 11:36:00       7           7     138
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA           7      81
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA          NA      NA
#&gt; 26       2     1    6 2019-10-23 15:55:00       7          NA      NA
#&gt; 27       2     1    7 2019-10-23 16:52:00       7           7      57
#&gt; 28       2     1    8 2019-10-23 19:23:00       1           7     151
#&gt; 29       2     1    9 2019-10-23 20:13:00       7           1      50
#&gt; 30       2     1   10 2019-10-23 21:40:00       6           7      87
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA          NA      NA
#&gt; 32       2     2   12 2019-10-24 09:55:00       7          NA      NA
#&gt; 33       2     2   13 2019-10-24 11:41:00       6           7     106
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA           6      88
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA          NA      NA
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA          NA      NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7          NA      NA
#&gt; 38       2     2   18 2019-10-24 19:38:00       4           7     122
#&gt; 39       2     2   19 2019-10-24 21:06:00       7           4      88
#&gt; 40       2     2   20 2019-10-24 22:16:00       7           7      70</div><div class='input'>
<span class='co'># remove those new variables</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>dat</span>$<span class='no'>timelag</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject dayno beep            beeptime relaxed
#&gt; 1        1     1    1 2019-10-20 08:03:00       2
#&gt; 2        1     1    2 2019-10-20 10:00:00       6
#&gt; 3        1     1    3 2019-10-20 11:18:00       6
#&gt; 4        1     1    4 2019-10-20 12:34:00       6
#&gt; 5        1     1    5 2019-10-20 14:16:00       5
#&gt; 6        1     1    6 2019-10-20 16:15:00       6
#&gt; 7        1     1    7 2019-10-20 16:47:00       6
#&gt; 8        1     1    8 2019-10-20 19:01:00       6
#&gt; 9        1     1    9 2019-10-20 20:16:00      NA
#&gt; 10       1     1   10 2019-10-20 21:22:00       5
#&gt; 11       1     2   11 2019-10-21 08:42:00       1
#&gt; 12       1     2   12 2019-10-21 09:33:00      NA
#&gt; 13       1     2   13 2019-10-21 11:38:00       6
#&gt; 14       1     2   14 2019-10-21 13:09:00       6
#&gt; 15       1     2   15 2019-10-21 14:26:00       6
#&gt; 16       1     2   16 2019-10-21 15:55:00      NA
#&gt; 17       1     2   17 2019-10-21 17:18:00       6
#&gt; 18       1     2   18 2019-10-21 18:28:00       6
#&gt; 19       1     2   19 2019-10-21 20:18:00       6
#&gt; 20       1     2   20 2019-10-21 22:08:00       4
#&gt; 21       2     1    1 2019-10-23 08:33:00       2
#&gt; 22       2     1    2 2019-10-23 09:18:00       7
#&gt; 23       2     1    3 2019-10-23 11:36:00       7
#&gt; 24       2     1    4 2019-10-23 12:57:00      NA
#&gt; 25       2     1    5 2019-10-23 14:13:00      NA
#&gt; 26       2     1    6 2019-10-23 15:55:00       7
#&gt; 27       2     1    7 2019-10-23 16:52:00       7
#&gt; 28       2     1    8 2019-10-23 19:23:00       1
#&gt; 29       2     1    9 2019-10-23 20:13:00       7
#&gt; 30       2     1   10 2019-10-23 21:40:00       6
#&gt; 31       2     2   11 2019-10-24 08:58:00      NA
#&gt; 32       2     2   12 2019-10-24 09:55:00       7
#&gt; 33       2     2   13 2019-10-24 11:41:00       6
#&gt; 34       2     2   14 2019-10-24 13:09:00      NA
#&gt; 35       2     2   15 2019-10-24 15:06:00      NA
#&gt; 36       2     2   16 2019-10-24 16:01:00      NA
#&gt; 37       2     2   17 2019-10-24 17:36:00       7
#&gt; 38       2     2   18 2019-10-24 19:38:00       4
#&gt; 39       2     2   19 2019-10-24 21:06:00       7
#&gt; 40       2     2   20 2019-10-24 22:16:00       7</div><div class='input'>
<span class='co'># suppose the 'dayno' variable is not available</span>
<span class='no'>dat</span>$<span class='no'>dayno</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject beep            beeptime relaxed
#&gt; 1        1    1 2019-10-20 08:03:00       2
#&gt; 2        1    2 2019-10-20 10:00:00       6
#&gt; 3        1    3 2019-10-20 11:18:00       6
#&gt; 4        1    4 2019-10-20 12:34:00       6
#&gt; 5        1    5 2019-10-20 14:16:00       5
#&gt; 6        1    6 2019-10-20 16:15:00       6
#&gt; 7        1    7 2019-10-20 16:47:00       6
#&gt; 8        1    8 2019-10-20 19:01:00       6
#&gt; 9        1    9 2019-10-20 20:16:00      NA
#&gt; 10       1   10 2019-10-20 21:22:00       5
#&gt; 11       1   11 2019-10-21 08:42:00       1
#&gt; 12       1   12 2019-10-21 09:33:00      NA
#&gt; 13       1   13 2019-10-21 11:38:00       6
#&gt; 14       1   14 2019-10-21 13:09:00       6
#&gt; 15       1   15 2019-10-21 14:26:00       6
#&gt; 16       1   16 2019-10-21 15:55:00      NA
#&gt; 17       1   17 2019-10-21 17:18:00       6
#&gt; 18       1   18 2019-10-21 18:28:00       6
#&gt; 19       1   19 2019-10-21 20:18:00       6
#&gt; 20       1   20 2019-10-21 22:08:00       4
#&gt; 21       2    1 2019-10-23 08:33:00       2
#&gt; 22       2    2 2019-10-23 09:18:00       7
#&gt; 23       2    3 2019-10-23 11:36:00       7
#&gt; 24       2    4 2019-10-23 12:57:00      NA
#&gt; 25       2    5 2019-10-23 14:13:00      NA
#&gt; 26       2    6 2019-10-23 15:55:00       7
#&gt; 27       2    7 2019-10-23 16:52:00       7
#&gt; 28       2    8 2019-10-23 19:23:00       1
#&gt; 29       2    9 2019-10-23 20:13:00       7
#&gt; 30       2   10 2019-10-23 21:40:00       6
#&gt; 31       2   11 2019-10-24 08:58:00      NA
#&gt; 32       2   12 2019-10-24 09:55:00       7
#&gt; 33       2   13 2019-10-24 11:41:00       6
#&gt; 34       2   14 2019-10-24 13:09:00      NA
#&gt; 35       2   15 2019-10-24 15:06:00      NA
#&gt; 36       2   16 2019-10-24 16:01:00      NA
#&gt; 37       2   17 2019-10-24 17:36:00       7
#&gt; 38       2   18 2019-10-24 19:38:00       4
#&gt; 39       2   19 2019-10-24 21:06:00       7
#&gt; 40       2   20 2019-10-24 22:16:00       7</div><div class='input'>
<span class='co'># we can recreate this based on the 'beeptime' variable</span>
<span class='no'>dat</span>$<span class='no'>dayno</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/split.html'>unsplit</a></span>(
   <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/split.html'>split</a></span>(<span class='no'>dat</span>$<span class='no'>beeptime</span>, <span class='no'>dat</span>$<span class='no'>subject</span>), <span class='kw'>function</span>(<span class='no'>x</span>) {
      <span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span>(<span class='no'>x</span>, <span class='kw'>format</span><span class='kw'>=</span><span class='st'>"%Y-%m-%d"</span>)
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span>(<span class='no'>z</span>, <span class='no'>z</span>[<span class='fl'>1</span>], <span class='kw'>units</span><span class='kw'>=</span><span class='st'>"days"</span>)) + <span class='fl'>1</span>
   }), <span class='no'>dat</span>$<span class='no'>subject</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject beep            beeptime relaxed dayno
#&gt; 1        1    1 2019-10-20 08:03:00       2     1
#&gt; 2        1    2 2019-10-20 10:00:00       6     1
#&gt; 3        1    3 2019-10-20 11:18:00       6     1
#&gt; 4        1    4 2019-10-20 12:34:00       6     1
#&gt; 5        1    5 2019-10-20 14:16:00       5     1
#&gt; 6        1    6 2019-10-20 16:15:00       6     1
#&gt; 7        1    7 2019-10-20 16:47:00       6     1
#&gt; 8        1    8 2019-10-20 19:01:00       6     1
#&gt; 9        1    9 2019-10-20 20:16:00      NA     1
#&gt; 10       1   10 2019-10-20 21:22:00       5     1
#&gt; 11       1   11 2019-10-21 08:42:00       1     2
#&gt; 12       1   12 2019-10-21 09:33:00      NA     2
#&gt; 13       1   13 2019-10-21 11:38:00       6     2
#&gt; 14       1   14 2019-10-21 13:09:00       6     2
#&gt; 15       1   15 2019-10-21 14:26:00       6     2
#&gt; 16       1   16 2019-10-21 15:55:00      NA     2
#&gt; 17       1   17 2019-10-21 17:18:00       6     2
#&gt; 18       1   18 2019-10-21 18:28:00       6     2
#&gt; 19       1   19 2019-10-21 20:18:00       6     2
#&gt; 20       1   20 2019-10-21 22:08:00       4     2
#&gt; 21       2    1 2019-10-23 08:33:00       2     1
#&gt; 22       2    2 2019-10-23 09:18:00       7     1
#&gt; 23       2    3 2019-10-23 11:36:00       7     1
#&gt; 24       2    4 2019-10-23 12:57:00      NA     1
#&gt; 25       2    5 2019-10-23 14:13:00      NA     1
#&gt; 26       2    6 2019-10-23 15:55:00       7     1
#&gt; 27       2    7 2019-10-23 16:52:00       7     1
#&gt; 28       2    8 2019-10-23 19:23:00       1     1
#&gt; 29       2    9 2019-10-23 20:13:00       7     1
#&gt; 30       2   10 2019-10-23 21:40:00       6     1
#&gt; 31       2   11 2019-10-24 08:58:00      NA     2
#&gt; 32       2   12 2019-10-24 09:55:00       7     2
#&gt; 33       2   13 2019-10-24 11:41:00       6     2
#&gt; 34       2   14 2019-10-24 13:09:00      NA     2
#&gt; 35       2   15 2019-10-24 15:06:00      NA     2
#&gt; 36       2   16 2019-10-24 16:01:00      NA     2
#&gt; 37       2   17 2019-10-24 17:36:00       7     2
#&gt; 38       2   18 2019-10-24 19:38:00       4     2
#&gt; 39       2   19 2019-10-24 21:06:00       7     2
#&gt; 40       2   20 2019-10-24 22:16:00       7     2</div><div class='input'>
<span class='co'># now suppose the dataset does not include beeps that were not responded to</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span>[!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>dat</span>$<span class='no'>relaxed</span>),]
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject beep            beeptime relaxed dayno
#&gt; 1        1    1 2019-10-20 08:03:00       2     1
#&gt; 2        1    2 2019-10-20 10:00:00       6     1
#&gt; 3        1    3 2019-10-20 11:18:00       6     1
#&gt; 4        1    4 2019-10-20 12:34:00       6     1
#&gt; 5        1    5 2019-10-20 14:16:00       5     1
#&gt; 6        1    6 2019-10-20 16:15:00       6     1
#&gt; 7        1    7 2019-10-20 16:47:00       6     1
#&gt; 8        1    8 2019-10-20 19:01:00       6     1
#&gt; 10       1   10 2019-10-20 21:22:00       5     1
#&gt; 11       1   11 2019-10-21 08:42:00       1     2
#&gt; 13       1   13 2019-10-21 11:38:00       6     2
#&gt; 14       1   14 2019-10-21 13:09:00       6     2
#&gt; 15       1   15 2019-10-21 14:26:00       6     2
#&gt; 17       1   17 2019-10-21 17:18:00       6     2
#&gt; 18       1   18 2019-10-21 18:28:00       6     2
#&gt; 19       1   19 2019-10-21 20:18:00       6     2
#&gt; 20       1   20 2019-10-21 22:08:00       4     2
#&gt; 21       2    1 2019-10-23 08:33:00       2     1
#&gt; 22       2    2 2019-10-23 09:18:00       7     1
#&gt; 23       2    3 2019-10-23 11:36:00       7     1
#&gt; 26       2    6 2019-10-23 15:55:00       7     1
#&gt; 27       2    7 2019-10-23 16:52:00       7     1
#&gt; 28       2    8 2019-10-23 19:23:00       1     1
#&gt; 29       2    9 2019-10-23 20:13:00       7     1
#&gt; 30       2   10 2019-10-23 21:40:00       6     1
#&gt; 32       2   12 2019-10-24 09:55:00       7     2
#&gt; 33       2   13 2019-10-24 11:41:00       6     2
#&gt; 37       2   17 2019-10-24 17:36:00       7     2
#&gt; 38       2   18 2019-10-24 19:38:00       4     2
#&gt; 39       2   19 2019-10-24 21:06:00       7     2
#&gt; 40       2   20 2019-10-24 22:16:00       7     2</div><div class='input'>
<span class='co'># in this case, specifying the 'obs' variable (i.e., 'beep') is crucial</span>
<span class='co'># note: the lagged value for beep 10 is missing, since beep 9 is missing</span>
<span class='no'>dat</span>$<span class='no'>relaxed_lag</span> <span class='kw'>&lt;-</span> <span class='fu'>lagvar</span>(<span class='no'>relaxed</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='no'>subject</span>, <span class='kw'>obs</span><span class='kw'>=</span><span class='no'>beep</span>, <span class='kw'>day</span><span class='kw'>=</span><span class='no'>dayno</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>dat</span>)
<span class='no'>dat</span></div><div class='output co'>#&gt;    subject beep            beeptime relaxed dayno relaxed_lag
#&gt; 1        1    1 2019-10-20 08:03:00       2     1          NA
#&gt; 2        1    2 2019-10-20 10:00:00       6     1           2
#&gt; 3        1    3 2019-10-20 11:18:00       6     1           6
#&gt; 4        1    4 2019-10-20 12:34:00       6     1           6
#&gt; 5        1    5 2019-10-20 14:16:00       5     1           6
#&gt; 6        1    6 2019-10-20 16:15:00       6     1           5
#&gt; 7        1    7 2019-10-20 16:47:00       6     1           6
#&gt; 8        1    8 2019-10-20 19:01:00       6     1           6
#&gt; 10       1   10 2019-10-20 21:22:00       5     1          NA
#&gt; 11       1   11 2019-10-21 08:42:00       1     2          NA
#&gt; 13       1   13 2019-10-21 11:38:00       6     2          NA
#&gt; 14       1   14 2019-10-21 13:09:00       6     2           6
#&gt; 15       1   15 2019-10-21 14:26:00       6     2           6
#&gt; 17       1   17 2019-10-21 17:18:00       6     2          NA
#&gt; 18       1   18 2019-10-21 18:28:00       6     2           6
#&gt; 19       1   19 2019-10-21 20:18:00       6     2           6
#&gt; 20       1   20 2019-10-21 22:08:00       4     2           6
#&gt; 21       2    1 2019-10-23 08:33:00       2     1          NA
#&gt; 22       2    2 2019-10-23 09:18:00       7     1           2
#&gt; 23       2    3 2019-10-23 11:36:00       7     1           7
#&gt; 26       2    6 2019-10-23 15:55:00       7     1          NA
#&gt; 27       2    7 2019-10-23 16:52:00       7     1           7
#&gt; 28       2    8 2019-10-23 19:23:00       1     1           7
#&gt; 29       2    9 2019-10-23 20:13:00       7     1           1
#&gt; 30       2   10 2019-10-23 21:40:00       6     1           7
#&gt; 32       2   12 2019-10-24 09:55:00       7     2          NA
#&gt; 33       2   13 2019-10-24 11:41:00       6     2           7
#&gt; 37       2   17 2019-10-24 17:36:00       7     2          NA
#&gt; 38       2   18 2019-10-24 19:38:00       4     2           7
#&gt; 39       2   19 2019-10-24 21:06:00       7     2           4
#&gt; 40       2   20 2019-10-24 22:16:00       7     2           7</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Wolfgang Viechtbauer <a href='mailto:wvb@wvbauer.com'>wvb@wvbauer.com</a> <br /></p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Wolfgang Viechtbauer, Mihail Constantin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


